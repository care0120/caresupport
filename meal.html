<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ™ é£Ÿäº‹ã®è¨˜éŒ²</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base target="_top"> <style>
    body {
      font-family: sans-serif;
      font-size: 26px; /* medicine.htmlã«åˆã‚ã›ã‚‹ */
      padding: 1.5em 0.5em 1.5em 0.5em; /* medicine.htmlã«åˆã‚ã›ã‚‹ */
      background: #fff;
      color: #000; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ–‡å­—è‰² */
      text-align: left;
      line-height: 1.5; /* è¡Œé–“ã®èª¿æ•´ */
    }
    h1 {
      font-size: 32px; /* medicine.htmlã«åˆã‚ã›ã‚‹ */
      margin: 0.2em 0 0.4em; /* medicine.htmlã«åˆã‚ã›ã‚‹ */
    }
    .section {
      margin-bottom: 1.5em; /* medicine.htmlã«åˆã‚ã›ã‚‹ */
    }
    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹/ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’èª¿æ•´ */
    .checkbox-grid, .radio-group {
      display: grid;
      /* æœ€å°å¹…ã‚’å°‘ã—åºƒã’ã¦é€£çµã‚’é˜²ãã€ç”»é¢å¹…ã«å¿œã˜ã¦åˆ—æ•°ã‚’èª¿æ•´ */
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
      gap: 1.2em; /* ãƒœã‚¿ãƒ³é–“ã®éš™é–“ã‚’å°‘ã—å¢—ã‚„ã™ */
    }
    /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹/ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
    .checkbox-grid label,
    .radio-group label {
      display: flex; 
      align-items: center;
      justify-content: center; /* æ°´å¹³æ–¹å‘ä¸­å¤® */
      text-align: center; /* ãƒ†ã‚­ã‚¹ãƒˆã‚‚ä¸­å¤®æƒãˆ */
      border: 2px solid #888;
      border-radius: 10px;
      padding: 0.8em 0.5em; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å·¦å³ã§å°‘ã—è©°ã‚ã‚‹ */
      background: #f0f0f0;
      cursor: pointer;
      font-size: 26px; 
      box-sizing: border-box; 
      white-space: nowrap; /* ãƒ†ã‚­ã‚¹ãƒˆãŒãƒœã‚¿ãƒ³å†…ã§æ”¹è¡Œã•ã‚Œãªã„ã‚ˆã†ã« */
      transition: background-color 0.2s, border-color 0.2s, color 0.2s; 
      min-width: 100px; /* å„ãƒœã‚¿ãƒ³ã®æœ€å°å¹…ã‚’ç¢ºä¿ */
      height: 2.5em; /* é«˜ã•ã‚’æƒãˆã‚‹ */
    }
    /* é¸æŠã•ã‚ŒãŸéš›ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .checkbox-grid input[type="checkbox"]:checked + label,
    .radio-group input[type="radio"]:checked + label {
      background: #007BFF;
      color: white;
      border-color: #0056b3;
    }

    /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã¨ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    textarea, input[type="text"] {
      width: 100%;
      font-size: 24px; 
      padding: 0.8em; 
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    textarea {
      height: 6em; 
      resize: vertical; 
    }
    input[type="text"][name="side"] { 
      height: auto; 
      min-height: 2.5em; 
    }

    /* ãŠã‹ãšã€æ„Ÿæƒ³ã®ãƒ©ãƒ™ãƒ«ã‚’ä¸»é£Ÿã¨åŒã˜ã‚µã‚¤ã‚ºã¨å¤ªå­—ã« */
    .section strong,
    .section > label { /* ç›´æ¥ã®labelè¦ç´ ã«é©ç”¨ */
        font-size: 26px; /* ä¸»é£Ÿã¨åŒã˜ã‚µã‚¤ã‚º */
        font-weight: bold; /* å¤ªå­— */
        display: block; /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã«ã—ã¦ç‹¬ç«‹ã•ã›ã‚‹ */
        margin-bottom: 0.5em; /* ä¸‹ã«å°‘ã—ä½™ç™½ */
    }

    /* ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« (medicine.htmlã‚’å‚è€ƒã«æ‹¡å¤§) */
    .send-btn, .back-btn {
      display: block; 
      font-size: 28px; 
      border-radius: 10px; 
      padding: 1.2em 2em; 
      cursor: pointer;
      box-sizing: border-box;
      white-space: nowrap; 
      text-align: center; 
      width: 100%; 
      max-width: 700px; 
      transition: background-color 0.2s, border-color 0.2s, color 0.2s; 
    }
    .send-btn {
      background-color: #add8e6; 
      color: #000; 
      border: 3px solid #007BFF; 
    }
    .send-btn:hover {
        background-color: #9ac0d6; 
    }
    .back-btn {
      background-color: #eeeeee; 
      color: #333; 
      border: 2px solid #999; 
    }
    .back-btn:hover {
        background-color: #dddddd; 
    }
    /* ãƒœã‚¿ãƒ³ã‚’ç¸¦ã«ä¸¦ã¹ã€ä¸­å¤®ã«é…ç½®ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ */
    .button-row {
      display: flex;
      flex-direction: column; 
      gap: 1.2em; 
      align-items: center; 
      margin-top: 2em; 
      width: 100%; 
    }

    /* ã€Œå±¥æ­´ã€ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿®æ­£ */
    #historyLink {
      position: fixed;
      bottom: 0.8rem; 
      right: 0.8rem; 
      font-size: 1.2rem; 
      opacity: 0.9; 
      color: #007BFF; 
      text-decoration: underline; 
      z-index: 9000; 
    }
    /* ã€ŒãŠã‹ãšã€ã¨ã€Œæ„Ÿæƒ³ã€ã®ä¾‹ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .sub {
      font-size: 26px; /* æ„Ÿæƒ³ã‚„ãŠã‹ãšã®ä¾‹ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ã€ä¸»é£Ÿã®ãƒ©ãƒ™ãƒ«ã¨åŒã˜ã«ã™ã‚‹ */
      color: #555;
      margin-bottom: 0.3em;
      margin-top: 0.3em; 
    }

    /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£ */
    #successPopup, #errorPopup {
        position:fixed; 
        top: 45%; 
        left:50%; 
        transform:translate(-50%, -50%);
        background: white; 
        border: 4px solid #007BFF; 
        border-radius: 16px; 
        padding: 1.5em 1em; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å·¦å³ã§å°‘ã—æ¸›ã‚‰ã™ */
        z-index: 9999;
        font-size: 2.2rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
        text-align: center; 
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
        max-width: 90vw; /* ç”»é¢å¹…ã®90%ã«åˆ¶é™ */
        word-break: keep-all; /* å˜èªã®é€”ä¸­ã§ã®æ”¹è¡Œã‚’é˜²ã */
    }
    #errorPopup {
        border: 2px solid red;
        color: red;
        background: #fff8f8;
    }
    /* é€ä¿¡å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èµ¤å­—ã«ã™ã‚‹ */
    #successPopup {
        color: red; 
    }
  </style>
</head>
<body>
  <h1>ğŸ™ é£Ÿäº‹ã®è¨˜éŒ²</h1>
  <form id="mealForm">
    <div class="section">
      <strong>ä¸»é£Ÿã‚’é¸æŠ</strong> 
      <div class="checkbox-grid">
        <label><input type="checkbox" name="main" value="ã”ã¯ã‚“" />ã”ã¯ã‚“</label>
        <label><input type="checkbox" name="main" value="ãƒ‘ãƒ³" />ãƒ‘ãƒ³</label>
        <label><input type="checkbox" name="main" value="ã‚ã‚“" />ã‚ã‚“</label>
        <label><input type="checkbox" name="main" value="é­š" />é­š</label>
        <label><input type="checkbox" name="main" value="è‚‰" />è‚‰</label>
        <label><input type="checkbox" name="main" value="é‡èœ" />é‡èœ</label>
        <label><input type="checkbox" name="main" value="å¼å½“" />å¼å½“</label>
      </div>
    </div>

    <div class="section">
      <label>ğŸ± ãŠã‹ãš</label> 
      <div class="sub">ï¼ˆä¾‹ï¼šãƒã‚­ãƒ³ã€ã‚µãƒ©ãƒ€ãªã©ï¼‰</div> 
      <textarea name="side" rows="1"></textarea>
    </div>

    <div class="section">
      <strong>é‡</strong> 
      <div class="radio-group">
        <label><input type="radio" name="amount" value="å¤šã‚" />å¤šã‚</label>
        <label><input type="radio" name="amount" value="ãµã¤ã†" />ãµã¤ã†</label>
        <label><input type="radio" name="amount" value="å°‘ãªã‚" />å°‘ãªã‚</label>
      </div>
    </div>

    <div class="section">
      <label>ğŸ€ æ„Ÿæƒ³ãƒ»æ°—ã«ãªã‚‹ã“ã¨</label> 
      <div class="sub">ï¼ˆğŸ™ï¸ãƒã‚¤ã‚¯ã§ã‚‚æ›¸ã‘ã¾ã™ï¼‰</div> 
      <textarea name="comment" rows="4"></textarea> 
    </div>

    <div class="button-row">
      <button type="button" class="send-btn" onclick="submitForm()">ğŸ‘† å ±å‘Šã™ã‚‹</button>
      <button type="button" class="back-btn" onclick="history.back()">â† æˆ»ã‚‹</button>
    </div>
  </form>

  <a id="historyLink" href="history.html">å±¥æ­´</a> 

  <div id="successPopup" style="display:none;">â­• é€ä¿¡å®Œäº†</div>
  <div id="errorPopup" style="display:none;">âŒ å…¥åŠ›ã—ã¦ãã ã•ã„</div>

  <script>
    // â˜…ã“ã“ã«GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URLã‚’è²¼ã‚Šä»˜ã‘ã‚‹â˜…
    const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbw5LUmzbYy9ja_39IBnD13088qnKtHFgRFfL-0ApPy21rHaxdS8hL83WsRiqY0yBWY/exec"; 

    async function submitForm() {
      const f = document.forms.mealForm;

      const main = [...f.main].filter(c => c.checked).map(c => c.value).join(',');
      const side = f.side.value.trim();
      const amount = f.amount.value || ""; 
      const comment = f.comment.value.trim();

      // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
      if (!main && !side && !amount && !comment) {
        document.getElementById("errorPopup").textContent = "âŒ ã„ãšã‚Œã‹1ã¤ã¯å…¥åŠ›ã—ã¦ãã ã•ã„";
        document.getElementById("errorPopup").style.display = "block";
        setTimeout(() => {
          document.getElementById("errorPopup").style.display = "none";
          document.getElementById("errorPopup").textContent = "âŒ å…¥åŠ›ã—ã¦ãã ã•ã„";
        }, 2000);
        return; 
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
      const data = {
        type: "meal", // GASã®doPostã§å‡¦ç†ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒ—
        values: [main, side, amount, comment]
      };

      try {
        const response = await fetch(GAS_WEB_APP_URL, {
          method: 'POST',
          mode: 'cors', // CORSãƒ¢ãƒ¼ãƒ‰ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data) // JSONå½¢å¼ã§é€ä¿¡
        });

        if (!response.ok) {
          // HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒ200ç•ªå°ä»¥å¤–ã®å ´åˆ
          const errorText = await response.text(); // ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æœ¬æ–‡ã‚’å–å¾—
          throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }

        const result = await response.json(); // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹

        if (result.status === 'ok') {
          document.getElementById("successPopup").style.display = "block";
          setTimeout(() => {
            document.getElementById("successPopup").style.display = "none";
            // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆ
            [...f.main].forEach(c => c.checked = false); 
            f.side.value = ""; 
            [...f.amount].forEach(r => r.checked = false); 
            f.comment.value = ""; 
          }, 2000); 
        } else {
          // GASã‹ã‚‰è¿”ã•ã‚ŒãŸã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚Œã°è¡¨ç¤º
          throw new Error(result.message || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼");
        }
      } catch (e) {
          console.error('é€ä¿¡ã‚¨ãƒ©ãƒ¼:', e);
          document.getElementById("errorPopup").textContent = "âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: " + e.message;
          document.getElementById("errorPopup").style.display = "block";
          setTimeout(() => {
            document.getElementById("errorPopup").style.display = "none";
            document.getElementById("errorPopup").textContent = "âŒ å…¥åŠ›ã—ã¦ãã ã•ã„"; 
          }, 4000); 
      }
    }
  </script>
</body>
</html>
